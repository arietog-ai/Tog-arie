<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>신의탑:새로운세계 블러연합용 계산기</title>
<style>
  :root{--bg:#0b0d11;--card:#141821;--muted:#9aa4b2;--text:#e8eef6;--ok:#7cf29a;--bad:#ff8a8a;--line:#1f2633}
  *{box-sizing:border-box}
  body{margin:0;background:var(--bg);color:var(--text);font-family:ui-sans-serif,system-ui,AppleSDGothicNeo,Segoe UI,Roboto,Pretendard}
  .wrap{max-width:1100px;margin:20px auto;padding:0 14px}
  h1{margin:0 0 12px;font-size:20px}
  .tabs{display:flex;gap:8px;margin:10px 0 16px}
  .tab{padding:10px 14px;border:1px solid var(--line);border-radius:12px;background:#111520;cursor:pointer}
  .tab.active{box-shadow:0 0 0 1px #2b3547 inset;background:#121a29}
  .card{background:#141821;border:1px solid var(--line);border-radius:16px;padding:14px}
  .grid{display:grid;gap:12px}
  .cols-3{grid-template-columns:1fr 1fr 1fr}
  .cols-2{grid-template-columns:1fr 1fr}
  label{display:block;font-size:12px;color:var(--muted);margin-bottom:6px}
  input,select,button{width:100%;padding:12px;border-radius:12px;border:1px solid #2b3547;background:#0f1420;color:var(--text)}
  button{cursor:pointer;font-weight:700}
  .row{display:flex;gap:10px;flex-wrap:wrap}
  .pill{display:inline-block;padding:4px 8px;border-radius:999px;background:#0f1420;border:1px solid #2b3547;color:var(--muted);font-size:12px}
  .muted{color:var(--muted)}
  .big{font-size:22px;font-weight:800}
  .ok{color:var(--ok)} .bad{color:var(--bad)}
  table{width:100%;border-collapse:collapse;font-size:14px}
  th,td{padding:10px;border-bottom:1px solid #222b3a;text-align:right}
  th:first-child,td:first-child{text-align:left}
  .items{display:grid;grid-template-columns:1fr 120px 90px;gap:8px;align-items:center}
  .itemline{display:contents}
  .itemname{white-space:normal} /* 말줄임 제거 */
  .sticky{position:sticky;bottom:8px;z-index:2}
  pre{white-space:pre-wrap;word-break:break-word}
  @media (max-width:900px){
    .cols-3,.cols-2{grid-template-columns:1fr}
    .items{grid-template-columns:1fr 120px 80px}
    input,select,button{padding:14px;font-size:16px}
  }
</style>
</head>
<body>
<div class="wrap">
  <h1>신의탑:새로운세계 블러연합용 계산기</h1>

  <div class="tabs">
    <div class="tab active" data-tab="calc">구매 계산</div>
    <div class="tab" data-tab="shop">개척상점 총합</div>
    <div class="tab" data-tab="info">기본 정보</div>
  </div>

  <!-- 구매 계산 -->
  <section id="calc" class="card">
    <div class="grid cols-3">
      <div>
        <label>현재 층수</label>
        <input id="floor" type="number" value="171" min="1" />
      </div>
      <div>
        <label>구역</label>
        <select id="zone">
          <option value="A">A (1–20)</option>
          <option value="B">B (21–40)</option>
          <option value="C">C (41–60)</option>
        </select>
      </div>
      <div class="card">
        <div class="pill">선택 구역</div>
        <div id="curLabel" class="big" style="margin-top:6px"></div>
        <div id="curHour" class="muted"></div>
      </div>
    </div>

    <hr style="border:none;border-top:1px solid #222b3a;margin:14px 0" />

    <!-- 세부 품목 단위 선택 -->
    <div class="pill">아이템 선택 (세부 품목별 선택 가능)</div>
    <div class="items" id="items" style="margin-top:8px">
      <div class="itemline">
        <div class="muted">항목명</div>
        <div class="muted" style="text-align:right">금액</div>
        <div class="muted" style="text-align:right">선택</div>
      </div>
    </div>

    <div class="row" style="margin-top:10px">
      <button id="btnAll">전체 선택/해제</button>
      <button id="btnNeed" class="sticky">부족 시 최소 층 계산</button>
    </div>

    <div id="result" class="grid cols-2" style="margin-top:12px">
      <div class="card">
        <div class="pill">선택 항목 합계</div>
        <div id="needSum" class="big"></div>
        <div id="needDetail" class="muted"></div>
      </div>
      <div class="card">
        <div class="pill">판정</div>
        <div id="judge" class="big"></div>
        <div id="lack" class="muted"></div>
      </div>
    </div>

    <!-- 결과 복사 (맨 아래) -->
    <div style="margin-top:14px">
      <div class="row">
        <button id="btnCopy" class="sticky">결과 복사</button>
      </div>
      <div class="pill" style="margin-top:8px">복사 미리보기</div>
      <pre id="copyText" class="muted"></pre>
    </div>
  </section>

  <!-- 상점 총합 -->
  <section id="shop" class="card" style="display:none">
    <div class="pill">항목별 총합 (금액 / 총개수)</div>
    <table style="margin-top:8px" id="shopTable">
      <thead><tr><th>항목</th><th>총 금액</th><th>총 개수</th></tr></thead>
      <tbody></tbody>
    </table>
    <div class="row" style="margin-top:10px">
      <div class="card">
        <div class="pill">전체 합계</div>
        <div class="big" id="shopGrand"></div>
      </div>
    </div>
  </section>

  <!-- 기본 정보 -->
  <section id="info" class="card" style="display:none">
    <div class="pill">규칙</div>
    <ul class="muted" style="line-height:1.6;margin-top:8px">
      <li>141층 이하: 구역당 +1.20/h</li>
      <li>151층 A까지 위 규칙 유지</li>
      <li>151층 B부터: 구역당 +1.50/h</li>
      <li>층 A→다음층 A: 141~150 = +3.6/h, 152~ = +4.5/h</li>
      <li>앵커: 141A=856.50/h, 151A=892.50/h</li>
      <li>2주 = 336시간</li>
    </ul>
  </section>
</div>

<script>
  // === 숫자 포맷 ===
  const nf  = (n)=> new Intl.NumberFormat('ko-KR').format(n);
  const nf1 = (n)=> new Intl.NumberFormat('ko-KR',{minimumFractionDigits:1,maximumFractionDigits:1}).format(n);

  // === 상점 데이터(세부 품목 단위) ===
  // name: 표시에 쓰일 이름, price: 1세트 금액, times: 구매 가능 횟수
  const shopData = [
    {cat:"비밀모집", name:"10개", price:10000, times:20},
    {cat:"비밀모집", name:"10개", price:10000, times:10},

    {cat:"레볼(초록)", name:"100개", price:1600, times:14},
    {cat:"레볼(초록)", name:"100개", price:1800, times:14},
    {cat:"레볼(초록)", name:"100개", price:2000, times:14},
    {cat:"레볼(초록)", name:"100개", price:2200, times:14},

    {cat:"빛레볼(빨강)", name:"100개", price:1080, times:50},
    {cat:"빛레볼(빨강)", name:"100개", price:1200, times:50},
    {cat:"빛레볼(빨강)", name:"100개", price:1320, times:50},

    {cat:"레볼 원석(보라)", name:"10개", price:900,  times:10},
    {cat:"레볼 원석(보라)", name:"10개", price:1000, times:10},

    {cat:"링경", name:"1개", price:1280, times:15},
    {cat:"링경", name:"1개", price:1440, times:10},

    {cat:"시무 주사위", name:"1개", price:2900,  times:50},
    {cat:"시무 주사위", name:"1개", price:4100,  times:30},
    {cat:"시무 주사위", name:"1개", price:29000, times:10},

    {cat:"시무 열쇠", name:"1개", price:300, times:100},
    {cat:"시무 열쇠", name:"1개", price:420, times:50},

    {cat:"고급숯돌", name:"1개", price:1500, times:10},
    {cat:"고급숯돌", name:"1개", price:2100, times:5},

    {cat:"힘/민/지 수정(빨)", name:"500개", price:500, times:50},
    {cat:"힘/민/지 수정(빨)", name:"500개", price:600, times:40},
    {cat:"힘/민/지 수정(초)", name:"500개", price:500, times:50},
    {cat:"힘/민/지 수정(초)", name:"500개", price:600, times:40},
    {cat:"힘/민/지 수정(파)", name:"500개", price:500, times:50},
    {cat:"힘/민/지 수정(파)", name:"500개", price:600, times:40},

    {cat:"강화액(파랑)", name:"50개", price:2000, times:20},
    {cat:"강화액(노랑)", name:"50개", price:2500, times:20},
    {cat:"강화액(주황)", name:"50개", price:3200, times:20},

    {cat:"최고급 강화액 선택상자", name:"50개", price:4000, times:50},

    {cat:"데이터 파편", name:"100개", price:2400, times:30},

    // 클래스 파편(6종류 × 10/5회)
    {cat:"클래스 파편-탱커", name:"100개", price:4320, times:10},
    {cat:"클래스 파편-탱커", name:"100개", price:4320, times:5},
    {cat:"클래스 파편-전사", name:"100개", price:4320, times:10},
    {cat:"클래스 파편-전사", name:"100개", price:4320, times:5},
    {cat:"클래스 파편-암살자", name:"100개", price:4320, times:10},
    {cat:"클래스 파편-암살자", name:"100개", price:4320, times:5},
    {cat:"클래스 파편-원거리", name:"100개", price:4320, times:10},
    {cat:"클래스 파편-원거리", name:"100개", price:4320, times:5},
    {cat:"클래스 파편-마력", name:"100개", price:4320, times:10},
    {cat:"클래스 파편-마력", name:"100개", price:4320, times:5},
    {cat:"클래스 파편-서포터", name:"100개", price:4320, times:10},
    {cat:"클래스 파편-서포터", name:"100개", price:4320, times:5}
  ];

  // 요약 테이블용(총합)
  const shopSummary = (()=>{
    const sum = {};
    for(const r of shopData){
      const key = r.cat.includes("클래스 파편-") ? "클래스 파편" : r.cat;
      if(!sum[key]) sum[key] = {total:0,count:0};
      sum[key].total += r.price * r.times;
      // count는 세트 개수가 아니라 '아이템 수량 총계'가 아니므로 총합 표시는 기존 기준 유지(요청 시 조정 가능)
      sum[key].count += (r.times * (parseInt(r.name) || 1));
    }
    return sum;
  })();

  // === 시급 계산 규칙 ===
  function hourlyFor(floor, zone){
    floor = Number(floor); const z = zone.toUpperCase();
    const a = (floor <= 150)
      ? 856.50 + (floor - 141) * 3.6
      : (floor === 151 ? 892.50 : 892.50 + (floor - 151) * 4.5);
    const offset = (floor >= 151 ? {A:0,B:1.5,C:3.0} : {A:0,B:1.2,C:2.4});
    return +(a + offset[z]).toFixed(1);
  }
  const TWO_WEEKS = 336;

  // === UI 채움: 선택구역 카드 ===
  function renderCurrent(){
    const f = Number(document.getElementById('floor').value);
    const z = document.getElementById('zone').value;
    const perH = hourlyFor(f,z);
    const two = Math.round(perH*TWO_WEEKS);
    document.getElementById('curLabel').textContent = `${f}층 ${z}구역`;
    document.getElementById('curHour').textContent = `시급: ${nf1(perH)} / h · 2주: ${nf(two)}`;
  }

  // === 아이템 리스트(세부 품목) ===
  const itemsDiv = document.getElementById('items');
  let toggleAll = false;
  function renderItems(){
    // 헤더 유지하고 나머지 채우기
    itemsDiv.querySelectorAll('.itemline:not(:first-child)').forEach(n=>n.remove());
    shopData.forEach((r, i)=>{
      const line = document.createElement('div'); line.className='itemline';
      const priceSum = r.price; // 1회 가격
      line.innerHTML = `
        <div class="itemname" title="${r.cat} · ${r.name} × ${r.times}회">
          ${r.cat} · ${r.name} × ${r.times}회
        </div>
        <div style="text-align:right">${nf(priceSum)}</div>
        <div style="text-align:right">
          <input type="checkbox" class="pick" id="pick_${i}" data-i="${i}" />
        </div>`;
      itemsDiv.appendChild(line);
    });
  }
  renderItems();

  // === 선택 합계/판정 ===
  function selectedTotal(){
    let sum = 0; let lines=[];
    document.querySelectorAll('.pick:checked').forEach(cb=>{
      const i = Number(cb.dataset.i);
      const r = shopData[i];
      const totalForThis = r.price * r.times; // 세부 품목 총액
      sum += totalForThis;
      lines.push(`${r.cat}·${r.name} × ${r.times}회: ${nf(totalForThis)}`);
    });
    return {sum, lines};
  }

  function updateCalc(){
    renderCurrent();
    const f = Number(document.getElementById('floor').value);
    const z = document.getElementById('zone').value;
    const perH = hourlyFor(f,z);
    const income = Math.round(perH*TWO_WEEKS);
    const {sum, lines} = selectedTotal();

    document.getElementById('needSum').textContent = nf(sum);
    document.getElementById('needDetail').textContent = lines.length? lines.join(' / ') : '선택된 항목이 없습니다.';

    const judgeEl = document.getElementById('judge');
    const lackEl = document.getElementById('lack');
    if(sum===0){
      judgeEl.textContent='항목을 선택하세요'; judgeEl.className='big';
      lackEl.textContent=''; buildCopy(); return;
    }
    if(income >= sum){
      judgeEl.textContent='구매 가능'; judgeEl.className='big ok';
      lackEl.textContent=`2주 누적: ${nf(income)} ≥ 필요: ${nf(sum)}`;
    }else{
      judgeEl.textContent='부족'; judgeEl.className='big bad';
      lackEl.textContent=`부족분: ${nf(sum - income)} (2주: ${nf(income)})`;
    }
    buildCopy();
  }

  // 최소 필요 층(같은 구역)
  function neededFloor(){
    const start = Number(document.getElementById('floor').value);
    const z = document.getElementById('zone').value;
    const {sum} = selectedTotal();
    if(sum===0){ alert('항목을 먼저 선택하세요.'); return; }
    let f = start;
    while(f <= 2000 && (hourlyFor(f,z)*TWO_WEEKS) < sum) f++;
    const perHstart = hourlyFor(start,z);
    const incomeAtStart = Math.round(perHstart*TWO_WEEKS);
    const lack = Math.max(0, sum - incomeAtStart);
    const judgeEl = document.getElementById('judge');
    const ok = (lack===0);
    judgeEl.textContent = ok ? '구매 가능' : '부족';
    judgeEl.className = ok ? 'big ok' : 'big bad';
    document.getElementById('lack').textContent =
      ok ? `현재 층에서 구매 가능` :
           `부족분: ${nf(lack)} → 최소 ${f}층 ${z}구역에서 가능 (2주 기준)`;
    buildCopy();
  }

  // 결과 복사(미리보기: 불필요한 총시급/총2주 제거)
  function buildCopy(){
    const f = Number(document.getElementById('floor').value);
    const z = document.getElementById('zone').value;
    const per = hourlyFor(f,z);
    const two = Math.round(per*TWO_WEEKS);
    const {sum, lines} = selectedTotal();
    const needText = (lines.length? lines.join('\n') : '선택 없음');

    const text =
`[신의탑:새로운세계 블러연합용 계산]
현재 위치: ${f}층 ${z}구역
시급: ${nf1(per)} / h
2주 누적: ${nf(two)}

선택 항목 합계: ${nf(sum)}
- 상세:
${needText}`;
    document.getElementById('copyText').textContent = text;
  }

  document.getElementById('btnNeed').addEventListener('click', neededFloor);
  document.getElementById('btnCopy').addEventListener('click', async ()=>{
    try{
      await navigator.clipboard.writeText(document.getElementById('copyText').textContent);
      alert('복사되었습니다. 카톡에 붙여넣기 하세요.');
    }catch(e){ alert('복사 실패: 브라우저 권한을 확인하세요.'); }
  });
  document.getElementById('btnAll').addEventListener('click', ()=>{
    toggleAll = !toggleAll;
    document.querySelectorAll('.pick').forEach(cb=> cb.checked = toggleAll);
    updateCalc();
  });

  // 자동 계산 트리거
  itemsDiv.addEventListener('change', (e)=>{
    if(e.target.classList.contains('pick')) updateCalc();
  });
  ['floor','zone'].forEach(id=> document.getElementById(id).addEventListener('input', updateCalc));

  // 상점 요약 표
  function buildShop(){
    const tbody = document.querySelector('#shopTable tbody'); tbody.innerHTML='';
    let grand=0;
    Object.entries(shopSummary).forEach(([name, {total, count}])=>{
      grand += total;
      const tr=document.createElement('tr');
      tr.innerHTML = `<td>${name}</td><td>${nf(total)}</td><td>${nf(count)}</td>`;
      tbody.appendChild(tr);
    });
    document.getElementById('shopGrand').textContent = nf(grand);
  }

  // 탭 전환
  document.querySelectorAll('.tab').forEach(el=>{
    el.addEventListener('click', ()=>{
      document.querySelectorAll('.tab').forEach(t=>t.classList.remove('active'));
      el.classList.add('active');
      const tab = el.dataset.tab;
      ['calc','shop','info'].forEach(id=>{
        document.getElementById(id).style.display = (id===tab)?'block':'none';
      });
    });
  });

  // 초기 렌더
  buildShop();
  renderCurrent();
  updateCalc();
</script>
</body>
</html>
